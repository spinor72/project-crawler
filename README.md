# Курсовой проект по курсу OTUS DevOPs 2018-02
Проект предназначен для автоматизации процессов создания инфрастурктуры, CI/CD и сбора обратной связи для тестового приложения Crawler

## Приложение Crawler
- Приложение имеет микросервисную архитектуру
 - Основной компонет - поисковый бот `Search Engine Crawler` 
 - Для поиска по индескированным ботом сайтам используется компонет web-интерфейса `Search Engine UI`
 - Бэкэнд компоненты -  базы данных MongoDB и очередь сообщений RabbitMQ

## Описание проекта

 - Инфраструктура построена на базе Google cloud platform
 - Для создания и управления ресурсами используется terraform, ansible
 - Приложения и сервисы запускаются в кластере Kubernetes (GKE)
 - Для развертывания используется Helm
 - Используется google cloud DNS 
 - Сертификаты для https генерирубтся с помощью Let's encrypt
 - CI/CD построен на базе Gitlab CE
 - Мониторинг организован на стэке prometheus
 - Логирование на стеке EFK
 - Для разработки использовалось доменное имя rportal.cloud .

## Начало работы
 - Установить необходимые утилиты make, kubectl, ansible, terraform, 
 - Настроить доступ к GCP
 - Клонировать репозиторий
 - Скопировать `/kubernetes/terraform/terraform.tfvars.example` в `/kubernetes/terraform/terraform.tfvars` и задать свои значения для переменных
 - Скопировать `/docker/.env.example` в `/docker/.env` и задать свои значения переменных среды
 - Запустить создание ифраструктуры  командой `make k8s_terraform` 
 - Настроить пакетный менеджер Helm для работы с созданным кластером командой `make k8s_helm_init`
 - Развернуть в созданном кластере Gitlab командой `make k8s_helm_gitlab` , после  развертывания команда выведет первоначальный пароль для входа в Gitlab
 - Залогиниться в  Gitlab  (gitlab.rportal.cloud) и создать пользователя и группу. 
 - В группе создать 3 проекта: deploy, engine, ui (пока корректно работает только с публичными проектами)
 - Создать токен для доступа к проектам
 - Задать значения секретных переменных
 - Запушить в 3 созданных проекта файлы из соотвествующих подпапок в /src
 - Установить мониторинг и логировани командами `make k8s_prometheus` `make k8s_grafana` `make k8s_grafana_provisioning` `make k8s_efk`

## Как проверить
 - Проверить работу пайплайна в Gitlab CI
 - Окружения разворачиваются по адресам вида `environment.crawler.rportal.cloud`
 - Убедиться в работоспособности приложения в созданных CI-пайплайном  окружениях
 
 Развернутый проект см. gitlab.rportal.cloud
 
